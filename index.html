<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Voca Han&Hyo</title>
<link rel="icon" href="logo.png"/>

<style>
@font-face {
  font-family: 'SchoolSafetyTteokbokki';
  src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2510-1@1.0/HakgyoansimTTeokbokkiB.woff2') format('woff2');
  font-weight: normal;
  font-display: swap;
}
:root{
  --primary:#58CC02; --accent:#FFD166;
  --text:#233042; --bg:#F7FAF7; --white:#fff;
  --shadow:0 6px 18px rgba(0,0,0,.08);
  --br:#E6EFE5;
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font-family:'SchoolSafetyTteokbokki', sans-serif;
  font-weight:500;
  -webkit-tap-highlight-color: transparent;
}
.container{max-width:900px;margin:0 auto;padding:16px 16px 120px}
.hidden{display:none!important}

/* 상단 타이틀 */
.appbar{
  position:sticky;top:0;z-index:20;
  display:flex;align-items:center;justify-content:center;gap:8px;
  background:#fff;border-bottom:1px solid #eee;
  font-size:22px;font-weight:800;padding:10px;cursor:pointer;
}
.appbar img{width:36px;height:36px;border-radius:8px;}

/* 홈화면 */
.home-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:70vh;text-align:center}
.home-logo img{width:70px;height:70px;margin-bottom:20px;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;width:100%;max-width:400px;}
.card{
  background:#fff;border-radius:16px;padding:20px;
  box-shadow:var(--shadow);border:1px solid var(--br);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  font-weight:700;font-size:18px;min-height:100px;cursor:pointer;
}

/* 단계 그리드 */
.stage-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
.stage{
  background:#fff;border-radius:10px;padding:12px;
  box-shadow:var(--shadow);border:1px solid var(--br);
  display:flex;align-items:center;justify-content:center;
  font-size:14px;cursor:pointer;
}

/* 학습 화면 */
.study-card{
  background:#fff;border-radius:16px;padding:22px;
  box-shadow:var(--shadow);border:1px solid var(--br);
  text-align:center;
  min-height:360px;
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;
}
.word-index{font-size:14px;opacity:.7;margin-bottom:6px;}
.word{font-size:64px;font-weight:900;cursor:pointer;}
.meta{display:flex;gap:8px;align-items:center;justify-content:center;color:#555;font-size:16px;}
.meaning{background:#FFF8EC;border:1px dashed #FFD166;padding:14px;border-radius:12px;width:100%;font-size:16px;}
.example{background:#F6FBFF;border:1px dashed #A3D5FF;padding:18px;border-radius:12px;width:100%;font-size:15px;min-height:60px;}

/* 하단 큰 버튼 */
.bottom-bar{
  position:fixed;left:0;right:0;bottom:0;z-index:30;background:#fff;border-top:1px solid #eee;
  display:flex;justify-content:space-between;gap:10px;padding:10px 16px;
}
.bottom-bar button{
  flex:1;border:none;border-radius:14px;padding:16px;font-size:20px;font-weight:800;
  box-shadow:var(--shadow);cursor:pointer;
}
.prev-btn{background:#fff;color:var(--primary);border:2px solid var(--primary);}
.next-btn{background:var(--primary);color:#fff;}

/* 타이머 */
.timer{text-align:center;font-weight:800;margin:8px 0;font-size:15px;}

/* 퀴즈 */
.quiz-card{
  background:#fff;border-radius:16px;box-shadow:var(--shadow);border:1px solid var(--br);
  padding:24px;max-width:480px;margin:0 auto;text-align:center;
}
.quiz-q{font-weight:800;margin-bottom:6px;}
.quiz-answer{margin-top:6px;margin-bottom:12px;}
.input-row{display:flex;gap:6px;justify-content:center;align-items:center;}
.input-row input{flex:1;padding:10px 12px;border:1px solid #ccc;border-radius:10px;font-size:16px;}
.input-row button{padding:10px 12px;border:none;border-radius:10px;font-size:15px;cursor:pointer;}
.submit-btn{background:#58CC02;color:#fff;}
.hint-btn{background:#FFD166;color:#222;}
.hint{background:#FFF8EC;border:1px dashed #FFD166;padding:10px;border-radius:10px;margin-top:10px;font-size:14px;display:none;}

/* 토스트 */
.toast{
  position:fixed;top:20px;left:50%;transform:translateX(-50%);
  background:#233042;color:#fff;padding:10px 16px;border-radius:12px;
  box-shadow:var(--shadow);font-size:14px;display:none;z-index:999;
}
</style>
</head>
<body>
<div class="appbar" id="titleBtn"><img src="logo.png">Voca Han&Hyo</div>

<div id="loader" class="home-wrap"><div>Loading...</div></div>

<div id="app" class="container hidden">
  <!-- 홈 -->
  <section id="homeView" class="view active">
    <div class="home-wrap">
      <div class="home-logo"><img src="logo.png" alt="logo"></div>
      <div class="grid2">
        <div class="card" id="goStudy">📘 단어 암기</div>
        <div class="card" id="goQuiz">📝 퀴즈</div>
      </div>
    </div>
  </section>

  <!-- 단계 선택 -->
  <section id="studySelectView" class="view">
    <h3>학습 단계 선택</h3>
    <div class="stage-grid" id="studyStageGrid"></div>
  </section>
  <section id="quizSelectView" class="view">
    <h3>퀴즈 단계 선택</h3>
    <div class="stage-grid" id="quizStageGrid"></div>
  </section>

  <!-- 학습 -->
  <section id="studyView" class="view">
    <div class="timer" id="studyTimer">남은 시간: 30:00</div>
    <div class="study-card">
      <div class="word-index" id="wordIndex">1/150</div>
      <div class="word" id="sWord">Word</div>
      <div class="meta"><span id="sPron"></span><span id="sIpa"></span></div>
      <div class="meaning" id="sMeaning">뜻이 여기에 표시됩니다</div>
      <div class="example" id="sExample">예문이 여기에 표시됩니다.</div>
    </div>
  </section>

  <!-- 퀴즈 -->
  <section id="quizView" class="view">
    <div class="timer" id="quizTimer">남은 시간: 30:00</div>
    <div class="quiz-card">
      <div class="quiz-q" id="qPrompt">—</div>
      <div class="quiz-answer" id="qMeaning">—</div>
      <div class="input-row">
        <input id="qInput" placeholder="정답 입력">
        <button class="submit-btn" id="qSubmit">제출</button>
        <button class="hint-btn" id="qHintBtn">힌트</button>
      </div>
      <div class="hint" id="qHint">예문</div>
    </div>
  </section>
</div>

<div class="bottom-bar hidden" id="bottomBar">
  <button class="prev-btn" id="prevBtn">← 이전</button>
  <button class="next-btn" id="nextBtn">다음 →</button>
</div>

<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const el=id=>document.getElementById(id);
const showToast=msg=>{const t=el('toast');t.textContent=msg;t.style.display='block';clearTimeout(t._t);t._t=setTimeout(()=>t.style.display='none',1500);}
const fmt=s=>{const m=Math.floor(s/60),ss=s%60;return m.toString().padStart(2,'0')+":"+ss.toString().padStart(2,'0');}
const speak=w=>{if(!('speechSynthesis'in window))return;const u=new SpeechSynthesisUtterance(w);u.lang='en-US';window.speechSynthesis.cancel();window.speechSynthesis.speak(u);}

let data=[],stage=1,idx=0,timer=null,remain=1800;
const PER=150,STAGES=30;

function switchView(v){document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));v.classList.add('active');}
function buildStageGrid(c,cb){c.innerHTML='';for(let i=1;i<=STAGES;i++){const b=document.createElement('div');b.className='stage';b.textContent=i;b.onclick=()=>cb(i);c.appendChild(b);}}
async function loadExcel(){
 try{
   const r=await fetch('./word_list.xlsx');const ab=await r.arrayBuffer();
   const wb=XLSX.read(ab,{type:'array'});
   const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1});
   return rows.slice(1).map(r=>({word:r[0],meaning:r[1],pron:r[2],ipa:r[3],ex:r[4]})).filter(x=>x.word);
 }catch(e){
   return [
     {word:'abandon',meaning:'버리다, 포기하다',pron:'어밴던',ipa:'əˈbændən',ex:'He had to abandon the plan.'},
     {word:'ability',meaning:'능력',pron:'어빌리티',ipa:'əˈbɪləti',ex:'She has the ability to lead.'},
   ];
 }
}

function startTimer(label){
 if(timer)clearInterval(timer);
 remain=1800;
 const t=el(label);
 t.textContent="남은 시간: "+fmt(remain);
 timer=setInterval(()=>{
   remain--;
   t.textContent="남은 시간: "+fmt(remain);
   if(remain<=0){clearInterval(timer);showToast('시간 종료');}
 },1000);
}

function startStudy(n){
 stage=n; idx=0;
 switchView(el('studyView'));
 el('bottomBar').classList.remove('hidden');
 startTimer('studyTimer');
 renderStudy();
}
function renderStudy(){
 const list=data.slice((stage-1)*PER,stage*PER);
 const w=list[idx]; if(!w)return;
 el('wordIndex').textContent=(idx+1)+"/"+list.length;
 el('sWord').textContent=w.word;
 el('sPron').textContent=w.pron||'';
 el('sIpa').textContent=w.ipa||'';
 el('sMeaning').textContent=w.meaning||'';
 el('sExample').textContent=w.ex||'';
}
el('sWord').onclick=()=>speak(el('sWord').textContent);
el('prevBtn').onclick=()=>{idx=Math.max(0,idx-1);renderStudy();}
el('nextBtn').onclick=()=>{idx++;renderStudy();}

function startQuiz(n){
 stage=n; idx=0;
 switchView(el('quizView'));
 startTimer('quizTimer');
 renderQuiz();
}
function normalizeKo(s){return s.replace(/\s+/g,'').split(',');}
function renderQuiz(){
 const list=data.slice((stage-1)*PER,stage*PER);
 const w=list[idx]; if(!w)return;
 const type=Math.random()<0.5?0:1;
 el('qInput').value=''; el('qHint').style.display='none';
 if(type===0){
   el('qPrompt').textContent='뜻을 보고 영어를 입력하세요';
   el('qMeaning').textContent=w.meaning;
   el('qHint').textContent=w.ex;
   el('qSubmit').onclick=()=>{
     if(el('qInput').value.trim().toLowerCase()===w.word.toLowerCase()){showToast('정답!');}
     else showToast('오답: '+w.word);
     idx++;renderQuiz();
   };
 }else{
   el('qPrompt').textContent='영어를 보고 뜻을 입력하세요';
   el('qMeaning').textContent=w.word;
   el('qHint').textContent=w.ex;
   el('qSubmit').onclick=()=>{
     const user=el('qInput').value.trim().replace(/\s+/g,'');
     const answers=normalizeKo(w.meaning);
     if(answers.some(a=>a&&a.includes(user)))showToast('정답!');
     else showToast('오답: '+w.meaning);
     idx++;renderQuiz();
   };
 }
 el('qMeaning').onclick=()=>{el('qHint').style.display='block';};
}

(async()=>{
 data=await loadExcel();
 buildStageGrid(el('studyStageGrid'),startStudy);
 buildStageGrid(el('quizStageGrid'),startQuiz);
 el('loader').classList.add('hidden');
 el('app').classList.remove('hidden');
})();
el('goStudy').onclick=()=>switchView(el('studySelectView'));
el('goQuiz').onclick=()=>switchView(el('quizSelectView'));
el('titleBtn').onclick=()=>{switchView(el('homeView'));el('bottomBar').classList.add('hidden');};
</script>
</body>
</html>