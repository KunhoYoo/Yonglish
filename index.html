<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Voca Duo+</title>
<link rel="icon" href="logo.png">
<style>
:root{
  --primary:#58CC02;--accent:#FFD166;--accent2:#73E0A9;--accent3:#A3D5FF;--accent4:#FFB3C6;
  --text:#233042;--bg:#F7FAF7;--white:#fff;
  --br:#E6EFE5;--shadow:0 6px 18px rgba(0,0,0,.08);--radius:18px
}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,sans-serif;
background:var(--bg);color:var(--text)}
.appbar{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;
background:rgba(255,255,255,.9);backdrop-filter:blur(6px);position:sticky;top:0;z-index:10}
.brand{display:flex;align-items:center;gap:8px;font-weight:800;font-size:20px}
.brand img{width:36px;height:36px;border-radius:8px;box-shadow:var(--shadow)}
.icon-btn{border:none;background:var(--white);padding:10px;border-radius:50%;box-shadow:var(--shadow)}
.container{max-width:900px;margin:0 auto;padding:16px}
.grid2{display:grid;grid-template-columns:1fr;gap:12px;margin-top:20px}
@media(min-width:480px){.grid2{grid-template-columns:1fr 1fr}}
.card{background:var(--white);border-radius:var(--radius);padding:24px;box-shadow:var(--shadow);
border:1px solid var(--br);text-align:center;font-weight:700;font-size:18px}
.stage-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
@media(min-width:540px){.stage-grid{grid-template-columns:repeat(5,1fr)}}
.stage{background:var(--white);border-radius:16px;padding:16px;box-shadow:var(--shadow);
border:1px solid var(--br);display:flex;flex-direction:column;align-items:center;justify-content:center}
.stage h4{margin:0;font-size:18px}
.hidden{display:none!important}
.center{display:grid;place-items:center;height:60vh}
.spinner{width:48px;height:48px;border:5px solid #e6f4e5;border-top-color:var(--primary);
border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:#233042;color:#fff;padding:10px 16px;border-radius:12px;font-size:14px;box-shadow:var(--shadow)}
.view{display:none}.view.active{display:block}
.topbar{display:flex;align-items:center;gap:10px;margin:10px 0}
.topbar button{border:none;background:var(--white);padding:8px 14px;border-radius:10px;box-shadow:var(--shadow)}
.study-card,.quiz-card{background:var(--white);border-radius:18px;padding:18px;box-shadow:var(--shadow);
border:1px solid var(--br);min-height:260px}
.word{font-size:36px;font-weight:900;text-align:center}
.meta{display:flex;justify-content:space-between;margin:4px 0;color:#555}
.example,.meaning{background:#FFF8EC;border:1px dashed #FFE6AE;padding:10px;border-radius:12px;font-size:14px}
.meaning.hidden{display:none}
.btn{border:none;padding:14px 16px;border-radius:14px;box-shadow:var(--shadow);font-weight:700}
.primary{background:var(--primary);color:#fff}
</style>
</head>
<body>
<div class="appbar">
  <div class="brand"><img src="logo.png">Voca Duo+</div>
  <button class="icon-btn" id="darkBtn">🌙</button>
</div>

<div id="loader" class="center"><div class="spinner"></div></div>
<div id="app" class="container hidden">
  <section id="homeView" class="view active">
    <div class="grid2">
      <button class="card" id="goStudy">📘 단어 암기</button>
      <button class="card" id="goQuiz">📝 퀴즈</button>
    </div>
  </section>

  <section id="studySelectView" class="view">
    <div class="topbar"><button id="backHome1">← 홈</button><b>단계를 선택하세요</b></div>
    <div class="stage-grid" id="studyStageGrid"></div>
  </section>

  <section id="quizSelectView" class="view">
    <div class="topbar"><button id="backHome2">← 홈</button><b>단계를 선택하세요</b></div>
    <div class="stage-grid" id="quizStageGrid"></div>
  </section>

  <section id="studyView" class="view">
    <div class="topbar"><button id="backStudy">← 단계선택</button><b id="studyHead"></b></div>
    <div class="study-card">
      <div class="word" id="sWord"></div>
      <div class="meta"><div id="sPron"></div><div id="sIpa"></div></div>
      <div class="example" id="sExample"></div>
      <div class="meaning" id="sMeaning"></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
        <button class="btn" id="prevBtn">← 이전</button>
        <button class="btn primary" id="nextBtn">다음 →</button>
      </div>
    </div>
  </section>

  <section id="quizView" class="view">
    <div class="topbar"><button id="backQuiz">← 단계선택</button><b id="quizHead"></b></div>
    <div class="quiz-card">
      <div id="qMeaning"></div>
      <input id="qInput" placeholder="영단어 입력" style="width:100%;padding:12px;border:1px solid var(--br);border-radius:8px;margin:10px 0">
      <button class="btn primary" id="qSubmit">제출</button>
      <div id="qHint" class="example hidden"></div>
    </div>
  </section>
</div>

<div id="toast" class="toast hidden"></div>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const WORDS_XLSX_URL="./word_list.xlsx";
const per=150, stages=30;
const el=id=>document.getElementById(id);
const Toast=m=>{const t=el('toast');t.textContent=m;t.classList.remove('hidden');
setTimeout(()=>t.classList.add('hidden'),2000)};
let data=[],stage=1,idx=0;

async function loadXlsx(){
 try{
  const r=await fetch(WORDS_XLSX_URL);if(!r.ok)throw 0;
  const ab=await r.arrayBuffer();
  const wb=XLSX.read(ab,{type:'array'});
  const sheet=wb.Sheets[wb.SheetNames[0]];
  const rows=XLSX.utils.sheet_to_json(sheet,{header:1});
  return rows.map(r=>({word:r[0],meaning:r[1],pron:r[2],ipa:r[3],ex:r[4]})).filter(r=>r.word);
 }catch(e){return [
  {word:'abandon',meaning:'버리다',pron:'어밴던',ipa:'əˈbændən',ex:'He had to abandon the plan.'},
  {word:'ability',meaning:'능력',pron:'어빌리티',ipa:'əˈbɪləti',ex:'She has the ability to lead.'}
 ];}
}

function buildGrid(container,onClick){
 container.innerHTML="";
 for(let i=1;i<=stages;i++){
  const s=(i-1)*per+1,e=i*per;
  const b=document.createElement('button');
  b.className='stage';
  b.innerHTML=`<h4>${String(i).padStart(2,'0')}</h4><small>${s}-${e}</small>`;
  b.onclick=()=>onClick(i);
  container.appendChild(b);
 }
}

function show(v){
 document.querySelectorAll('.view').forEach(x=>x.classList.remove('active'));
 v.classList.add('active');
 window.scrollTo({top:0});
}

function startStudy(n){
 stage=n;idx=0;
 el('studyHead').textContent=`단계 ${n}`;
 show(el('studyView'));
 renderStudy();
}
function renderStudy(){
 const list=data.slice((stage-1)*per,stage*per);
 const w=list[idx];
 el('sWord').textContent=w?.word||'-';
 el('sPron').textContent=w?.pron||'';
 el('sIpa').textContent=w?.ipa||'';
 el('sExample').textContent=w?.ex||'';
 el('sMeaning').textContent=w?.meaning||'';
}
el('prevBtn').onclick=()=>{idx=Math.max(0,idx-1);renderStudy()};
el('nextBtn').onclick=()=>{idx++;renderStudy()};

function startQuiz(n){
 stage=n;idx=0;
 show(el('quizView'));
 renderQuiz();
}
function renderQuiz(){
 const list=data.slice((stage-1)*per,stage*per);
 const w=list[idx];
 el('quizHead').textContent=`단계 ${stage} ${idx+1}/${list.length}`;
 el('qMeaning').textContent=w.meaning;
 el('qHint').textContent=w.ex.replace(new RegExp(w.word,'gi'),'████');
 el('qHint').classList.add('hidden');
 el('qSubmit').onclick=()=>{
  const ans=el('qInput').value.trim().toLowerCase();
  if(ans===w.word.toLowerCase())Toast('정답!');
  else Toast(`오답: ${w.word}`);
  idx++;
  if(idx<list.length)renderQuiz();else Toast('끝!');
 };
}

(async()=>{
 data=await loadXlsx();
 el('loader').classList.add('hidden');
 el('app').classList.remove('hidden');
 buildGrid(el('studyStageGrid'),startStudy);
 buildGrid(el('quizStageGrid'),startQuiz);
})();
el('goStudy').onclick=()=>show(el('studySelectView'));
el('goQuiz').onclick=()=>show(el('quizSelectView'));
el('backHome1').onclick=()=>show(el('homeView'));
el('backHome2').onclick=()=>show(el('homeView'));
el('backStudy').onclick=()=>show(el('studySelectView'));
el('backQuiz').onclick=()=>show(el('quizSelectView'));
</script>
</body>
</html>
